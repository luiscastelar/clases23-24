#curso23_24 #ED [estado:: Working] 


# Integración y desarrollo continuo
[Pruebas de integración](https://qalified.com/es/blog/pruebas-de-integracion-que-son/)



# Workflow completo MAVEN
![](https://raul-profesor.github.io/Despliegue/img/deployment-pipeline.png)

0. MVN y tomcat
1. Validación del código (linter): [plugins](https://blog.stackademic.com/7-best-plugins-to-improve-code-quality-in-java-0c96168203ab) para mvn. Nosotros usaremos [checkstyle](https://github.com/checkstyle/checkstyle) (mvn checkstyle:checkstyle)
2. Compilación (mvn compile)
3. Test unitarios (mvn test)
4. Empaquetado (mvn package / mvn war:war)
5. Documentación ([mvn site](https://maven.apache.org/plugins/maven-javadoc-plugin/usage.html) / mvn javadoc:javadoc)
6. Verificación (test de integración)
7. Instalación/[Despliegue](https://raul-profesor.github.io/Despliegue/P3.1-Tomcat/) (mvn ...)

Aunque el workflow habitual es el superior, nosotros vamos a continuar con la metodología TDD. *Para ello deberéis crear los paquetes `roja` y `verde` y aseguraros que la roja contempla TODOS los casos de uso.*

### MVN
Plantilla básica [`pom.xml`](https://github.com/luiscastelar/clases23-24/blob/main/ed/UT10-CI_CD/pom.xml)

Ciclo de vida mvn:
1.  **Validate:** This step validates if the project structure is correct. For example – It checks if all the dependencies have been downloaded and are available in the local repository.
2.  **Compile:** It compiles the source code, converts the .java files to .class, and stores the classes in the target/classes folder.
3.  **Test:** It runs unit tests for the project.
4.  **Package:** This step packages the compiled code in a distributable format like JAR or WAR.
5.  **Integration test:** It runs the integration tests for the project.
6.  **Verify:** This step runs checks to verify that the project is valid and meets the quality standards.
7.  **Install:** This step installs the packaged code to the local Maven repository.
8.  **Deploy:** It copies the packaged code to the remote repository for sharing it with other developers.

Comandos maven:
*   **mvn clean:** Cleans the project and removes all files generated by the previous build.
*   **mvn validate:** validate the project’s POM and configuration.
*   **mvn compile:** Compiles source code of the project.
*   **mvn test:** Runs tests for the project.
*   **mvn package:** Creates JAR or WAR file for the project to convert it into a distributable format.
*   **mvn install:** Deploys the packaged JAR/ WAR file to the local repository.
*   **mvn site:** generate the project documentation.
*   **mvn deploy:** Copies the packaged JAR/ WAR file to the remote repository after compiling, running tests and building the project.

Otros comandos:
*   **mvn test-compile:** Compiles the test source code.
*   **mvn idea:idea:** generate project files for IntelliJ IDEA or Eclipse.
*   **mvn release:perform:** Performs a release build.
*   **mvn archetype:generate:** This command is used to generate a new project from an archetype, which is a template for a project. This command is typically used to create new projects based on a specific pattern or structure.
*   **mvn dependency:tree:** This command is used to display the dependencies of the project in a tree format. This command is typically used to understand the dependencies of the project and troubleshoot any issues.

Fuente: [geek4geeks](https://www.geeksforgeeks.org/maven-lifecycle-and-basic-maven-commands/)


# PROYECTO
Deberéis crear un proyecto completo que utilice el workflow mostrado para una calculadora de pila que inicialmente implemente la interfaz [*CalculadoraDePila*](https://github.com/luiscastelar/clases23-24/blob/main/ed/UT10-CI_CD/CalculadoraDePila.java). 

## Fase TUI (librería)
Se adjunta la clase controlador [*MainCalculadoraDePila*](https://github.com/luiscastelar/clases23-24/blob/main/ed/UT10-CI_CD/MainCalculadoraDePila.java) y se pide:
1. Crear una batería de test siguiendo la metodología TDD.
2. Pasar los test de la fase roja.
   Dependencias (pom.xml):
    ```xml
    <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
      <modelVersion>4.0.0</modelVersion>
      <groupId>com.iescastelar</groupId>    
      <artifactId>calcualadoraDePila</artifactId>
      <version>0.1</version>
      <name>Calculadora de pila</name>
      <description>
          Calculadora de Pila en TUI y WebUI
      </description>
  
      <properties>
          <jdk.version>21</jdk.version>
          <junit.jupiter.version>5.8.2</junit.jupiter.version>
          <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
          <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
      </properties>
  
      <dependencies>
          <dependency>
              <groupId>org.junit.jupiter</groupId>
              <artifactId>junit-jupiter</artifactId>
              <version>${junit.jupiter.version}</version>
              <scope>test</scope>
          </dependency>
      </dependencies>
      <build>
          <plugins>
              <plugin>
                  <groupId>org.apache.maven.plugins</groupId>
                  <artifactId>maven-compiler-plugin</artifactId>
                  <version>3.8.0</version>
                  <configuration>
                      <source>${jdk.version}</source>
                      <target>${jdk.version}</target>
                      <encoding>${project.build.sourceEncoding}</encoding>
                  </configuration>
              </plugin>
              <plugin><!-- mvn surefire-report:report -->
                  <groupId>org.apache.maven.plugins</groupId>
                  <artifactId>maven-surefire-plugin</artifactId>
                  <version>2.22.2</version>
              </plugin>
          </plugins>
      </build>
    </project>
    ```
    *Nota: Debe funcionaros con **este** pom.xml*.

3. Implementar la calculadora.
4. Verificar que el texto está escrito siguiendo nomenclatura Sun o Google (a elegir).
5. Compilar (con mvn).
6. Pasar los test (fase verde).
7. Empaquetar a *jar*.
8. Ejecutar TUI.

Tu “scaffolding” debería quedar similar a:
```bash
.
├── pom.xml
├── salida.txt
└── src
    ├── main
    │   └── java
    │       └── com
    │           └── iescastelar
    │               ├── CalculadoraDePilaImpl.java
    │               ├── CalculadoraDePila.java
    │               ├── MainCalculadoraDePila.java
    │               └── package-info.java
    └── test
        ├── java
        │   └── com
        │       └── iescastelar
        │           └── CalculadoraTest.java
        └── resources
            └── casosDePrueba.csv

10 directories, 8 files
```

***Nota:** Deberéis subirlo a la `UT10-CI_CD/TUI` de vuestro repositorio del módulo formativo.*


### Fase TUI-1: TDD -> fase roja
1. Deberéis crear una rama en vuestro repositorio denominada `UT10-roja`.
2. Deberéis escribir la batería de pruebas del proyecto (calculadora RPN).
3. Deberéis probar y **capturar** la batería de pruebas donde se vea TODO rojo... con `mvn test`

   *Debéis probar TODOS los métodos*.

Notas:
1. *En esta fase está **prohibido** el uso de IDE*.
2. Recuerda que las capturas en cli (línea de comandos) **SIEMPRE** se realizan mediante el comando `tee` o `TeeObject`. *Deben llamarse **salida.txt** y ubicarse junto al pom.xml.*

### Fase TUI-2: TDD -> fase verde
1. Deberéis crear una rama en vuestro repositorio denominada `UT10-verde` a partir de la rama `UT10-roja`.
2. Deberéis adaptar/escribir el programa que desarrolla la calculadora y pasarle los test
3. Deberéis probar y **capturar** la batería de pruebas donde se vea TODO verde... con `mvn test`


### Fase TUI-3: Validación (linter)
En esta fase deberemos integrar una herramienta de análisis estático (linter) a través del plugin `checkstyle`:
```xml
    <reporting>
      <plugins>
        <plugin>
          <groupId>org.apache.maven.plugins</groupId>
          <artifactId>maven-checkstyle-plugin</artifactId>
          <version>3.3.1</version>
          <reportSets>
            <reportSet>
              <reports>
                <report>checkstyle</report>
              </reports>
            </reportSet>
          </reportSets>
        </plugin>
      </plugins>
    </reporting>
```
*Podéis consultar la documentación en la [fuente oficial](https://maven.apache.org/plugins/maven-checkstyle-plugin/usage.html)*

1. Deberéis crear una rama en vuestro repositorio denominada `UT10-pre-linter` a partir de la rama `UT10-verde`.
2. Deberéis realizar la validación del código escrito y obtener el reporte (site) y obtener 
3. Deberéis crear una rama en vuestro repositorio denominada `UT10-linter` a partir de la rama `UT10-pre-linter`.
4. Deberéis modificar vuestro código para pasar la validación y obtener el reporte (site).

### Fase TUI-4: Empaquetado
1. Deberéis obtener una aplicación `jar` plenamente funcional.
2. Deberéis generar un archivo ejecutable a partir de dicho jar para Windows (bat y ps1) y otro para GNU/Linux (.sh y [.desktop](https://askubuntu.com/questions/398666/execute-sh-script-from-desktop-file))

Deberéis modificar el pom.xml para añadir el main:
```xml
            <plugin>
              <groupId>org.apache.maven.plugins</groupId>
              <artifactId>maven-jar-plugin</artifactId>
              <configuration>
                <archive>
                  <manifest>
                    <addClasspath>true</addClasspath>
                    <mainClass>com.iescastelar.MainCalculadoraDePila</mainClass>
                  </manifest>
                </archive>
              </configuration>
            </plugin>
```


## Fase WebUI:
1. Modificar los test para recoger la integración WebUI.
2. Pasar los test de la fase roja.
3. Integrar la CalculadoraDePilaImpl como librería en proyecto web WebUI.
4. Verificar texto.
5. Compilar.
6. Pasar test (fase verde).
7. Empaquetar a **war**.
8. Desplegar.
9. Ejecutar WebUI.



# Fuentes:
+ [Ciclo de vida - maven](https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html)

+ [Github Actions](https://resources.github.com/learn/pathways/automation/essentials/automated-application-deployment-with-github-actions-and-pages/?ref=reactivisima.com)
+ [Compilación con GH Actions](https://docs.github.com/es/actions/automating-builds-and-tests/building-and-testing-java-with-maven)

+ [Base - Profesor Raúl /JENKINS/](https://raul-profesor.github.io/DEAW/cicd/)
+ [Paso a paso /JENKINS/](https://codingpotions.com/jenkins-integracion-continua/)

+ [HOOKS de Git](https://hardfloat.es/blog/2021/03/23/desplegar-aplicaciones-con-git.html)
+ [Proceso completo con Jenkins + K8s](https://medium.com/@ghazanfaralidevops/continuous-delivery-for-docker-containers-14f09c0d3e2d)
+ [Tutorial completo JENKINS - @CulturaDevOps](https://www.youtube.com/playlist?app=desktop&list=PLdOotbFwzDIiU4Hs8ySZr-phOeGMBY_3D&cbrd=1)
